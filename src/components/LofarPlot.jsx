import React from "react";
import Plot from "react-plotly.js";

// Define the transposeMatrix function
function transposeMatrix(matrix) {
  return matrix[0].map((_, colIndex) => matrix.map((row) => row[colIndex]));
}

function LofarPlot({ stftData, dimensions }) {
  if (!stftData.T || !stftData.F || !stftData.Zxx_compressed_resized) {
    return <p className="error">No valid data available</p>;
  }

  console.log(stftData);

  return (
    <svg
      width="600"
      height="354"
      viewBox="0 0 651 354"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M12.5 129V113.5V98L1 90V13V1H430.5L445.5 13H649.5V179.5V192V353H248H235.5H12.5V129ZM640 31H22.5V342H640V31Z"
        fill="url(#paint0_linear_437_1950)"
        stroke="#09B5FE"
        stroke-width="2"
      />
      <path
        d="M46.324 23.242C45.4147 23.242 44.5567 23.11 43.75 22.846C42.958 22.5673 42.298 22.1493 41.77 21.592L42.98 19.546L43.068 19.37L43.266 19.48C43.2953 19.5973 43.332 19.7147 43.376 19.832C43.4347 19.9347 43.552 20.0667 43.728 20.228C44.0947 20.5067 44.498 20.734 44.938 20.91C45.3927 21.086 45.884 21.174 46.412 21.174C47.1013 21.174 47.6587 21.0273 48.084 20.734C48.524 20.426 48.744 19.9787 48.744 19.392C48.744 19.0987 48.678 18.8273 48.546 18.578C48.414 18.314 48.15 18.05 47.754 17.786C47.3727 17.522 46.8007 17.214 46.038 16.862C45.0993 16.4513 44.3513 16.0407 43.794 15.63C43.2513 15.2047 42.8627 14.75 42.628 14.266C42.3933 13.7673 42.276 13.21 42.276 12.594C42.276 11.9193 42.4593 11.318 42.826 10.79C43.2073 10.262 43.728 9.844 44.388 9.536C45.048 9.228 45.8033 9.074 46.654 9.074C48.3407 9.074 49.7267 9.66067 50.812 10.834L49.36 12.506L49.228 12.66L49.052 12.528C49.0373 12.4107 49.008 12.3007 48.964 12.198C48.9347 12.0807 48.8393 11.934 48.678 11.758C48.3993 11.494 48.0987 11.318 47.776 11.23C47.468 11.142 47.1013 11.098 46.676 11.098C46.0747 11.098 45.598 11.2373 45.246 11.516C44.894 11.7947 44.718 12.1173 44.718 12.484C44.718 12.7773 44.784 13.0413 44.916 13.276C45.048 13.5107 45.312 13.76 45.708 14.024C46.1187 14.288 46.742 14.6033 47.578 14.97C48.502 15.3953 49.228 15.8133 49.756 16.224C50.284 16.62 50.6507 17.06 50.856 17.544C51.076 18.028 51.186 18.5927 51.186 19.238C51.186 19.898 51.0173 20.536 50.68 21.152C50.3427 21.768 49.8147 22.274 49.096 22.67C48.3773 23.0513 47.4533 23.242 46.324 23.242ZM55.036 9.294H57.742V9.492C57.654 9.58 57.5953 9.68267 57.566 9.8C57.5513 9.90267 57.544 10.0713 57.544 10.306V14.86H61.768V9.294H64.474V9.492C64.386 9.58 64.3347 9.68267 64.32 9.8C64.3053 9.90267 64.298 10.0713 64.298 10.306V23H61.768V16.84H57.544V23H55.036V9.294ZM72.944 23.264C71.2573 23.264 69.9813 22.648 69.116 21.416C68.2507 20.184 67.818 18.4313 67.818 16.158C67.818 13.9433 68.2507 12.2127 69.116 10.966C69.9813 9.71933 71.2573 9.096 72.944 9.096C74.6013 9.096 75.8627 9.71933 76.728 10.966C77.608 12.2127 78.048 13.9433 78.048 16.158C78.048 18.4313 77.608 20.184 76.728 21.416C75.8627 22.648 74.6013 23.264 72.944 23.264ZM72.944 21.24C73.7653 21.24 74.4107 20.822 74.88 19.986C75.3493 19.1353 75.584 17.852 75.584 16.136C75.584 14.5373 75.3493 13.3053 74.88 12.44C74.4107 11.56 73.7653 11.12 72.944 11.12C72.0933 11.12 71.4333 11.56 70.964 12.44C70.5093 13.3053 70.282 14.5373 70.282 16.136C70.282 17.852 70.5093 19.1353 70.964 19.986C71.4333 20.822 72.0933 21.24 72.944 21.24ZM81.59 23V9.294H85.924C87.596 9.294 88.8207 9.66067 89.598 10.394C90.3753 11.1273 90.764 12.1027 90.764 13.32C90.764 13.8187 90.654 14.3247 90.434 14.838C90.2287 15.3367 89.928 15.784 89.532 16.18C89.1507 16.576 88.7033 16.8693 88.19 17.06L91.138 23H88.52L85.748 17.302H84.098V23H81.59ZM84.098 15.234H86.1C86.804 15.234 87.332 15.0727 87.684 14.75C88.036 14.4127 88.212 13.958 88.212 13.386C88.212 12.858 88.036 12.4033 87.684 12.022C87.332 11.6407 86.804 11.45 86.1 11.45H84.098V15.234ZM98.002 23V11.384H94.306V9.294H104.272V11.384H100.378V23H98.002ZM124.402 23V11.384H120.706V9.294H130.672V11.384H126.778V23H124.402ZM134.94 23V20.998H137.624V11.296H135.094V9.294H142.662V11.296H139.978V20.998H142.772V23H134.94ZM147.304 23V9.294H149.482L152.144 15.586L154.806 9.272H156.984V23H154.828V13.43L152.672 18.468H151.462L149.438 13.452V23H147.304ZM160.922 23V9.294H169.854V11.318H163.342V14.838H168.688V16.884H163.342V20.976H169.788V23H160.922ZM175.31 17.038V14.97H181.734V17.038H175.31ZM187.652 23V9.294H196.188V11.296H189.874V14.618H195V16.62H189.874V23H187.652ZM200.39 23V9.294H204.724C206.396 9.294 207.621 9.66067 208.398 10.394C209.175 11.1273 209.564 12.1027 209.564 13.32C209.564 13.8187 209.454 14.3247 209.234 14.838C209.029 15.3367 208.728 15.784 208.332 16.18C207.951 16.576 207.503 16.8693 206.99 17.06L209.938 23H207.32L204.548 17.302H202.898V23H200.39ZM202.898 15.234H204.9C205.604 15.234 206.132 15.0727 206.484 14.75C206.836 14.4127 207.012 13.958 207.012 13.386C207.012 12.858 206.836 12.4033 206.484 12.022C206.132 11.6407 205.604 11.45 204.9 11.45H202.898V15.234ZM213.722 23V9.294H222.654V11.318H216.142V14.838H221.488V16.884H216.142V20.976H222.588V23H213.722ZM234.116 26.212C232.737 26.2267 231.747 26.014 231.146 25.574C230.559 25.134 230.251 24.3127 230.222 23.11C229.034 22.8607 228.073 22.1347 227.34 20.932C226.607 19.7293 226.24 18.138 226.24 16.158C226.24 14.4567 226.475 13.0853 226.944 12.044C227.413 11.0027 228.037 10.2473 228.814 9.778C229.591 9.30867 230.435 9.074 231.344 9.074C232.312 9.074 233.177 9.32333 233.94 9.822C234.717 10.3207 235.326 11.0907 235.766 12.132C236.206 13.1733 236.419 14.508 236.404 16.136C236.404 18.292 236.052 19.9273 235.348 21.042C234.659 22.142 233.727 22.8313 232.554 23.11C232.583 23.4473 232.686 23.7187 232.862 23.924C233.038 24.144 233.339 24.2467 233.764 24.232L235.568 24.144L235.524 26.212H234.116ZM231.388 21.196C231.843 21.196 232.268 21.0347 232.664 20.712C233.06 20.3747 233.383 19.8467 233.632 19.128C233.881 18.4093 234.006 17.4633 234.006 16.29C234.006 14.9993 233.874 13.9727 233.61 13.21C233.361 12.4473 233.031 11.9047 232.62 11.582C232.224 11.2593 231.799 11.098 231.344 11.098C230.508 11.098 229.855 11.538 229.386 12.418C228.917 13.2833 228.682 14.4567 228.682 15.938C228.682 17.654 228.924 18.9593 229.408 19.854C229.907 20.7487 230.567 21.196 231.388 21.196ZM244.5 23.286C242.989 23.286 241.823 22.8387 241.002 21.944C240.195 21.0493 239.792 19.8027 239.792 18.204V9.294H242.454V9.492C242.381 9.58 242.329 9.68267 242.3 9.8C242.285 9.90267 242.278 10.0713 242.278 10.306V18.226C242.278 19.1647 242.439 19.9053 242.762 20.448C243.085 20.9907 243.671 21.262 244.522 21.262C245.373 21.262 245.967 20.9907 246.304 20.448C246.641 19.9053 246.81 19.1427 246.81 18.16V9.294H249.23V18.138C249.23 19.898 248.79 21.196 247.91 22.032C247.03 22.868 245.893 23.286 244.5 23.286ZM253.322 23V9.294H262.254V11.318H255.742V14.838H261.088V16.884H255.742V20.976H262.188V23H253.322ZM266.214 9.294H268.81L273.452 18.314L273.32 9.294H275.74V9.492C275.667 9.58 275.615 9.68267 275.586 9.8C275.571 9.90267 275.564 10.0713 275.564 10.306V23H273.254L268.458 13.386V23H266.214V9.294ZM284.738 23.242C283.741 23.242 282.824 23 281.988 22.516C281.167 22.0173 280.507 21.2473 280.008 20.206C279.524 19.1647 279.282 17.8373 279.282 16.224C279.282 14.8747 279.443 13.7453 279.766 12.836C280.103 11.912 280.543 11.1787 281.086 10.636C281.629 10.0933 282.223 9.70467 282.868 9.47C283.528 9.22067 284.181 9.096 284.826 9.096C285.853 9.096 286.733 9.33067 287.466 9.8C288.214 10.2693 288.779 10.9293 289.16 11.78L287.598 12.946L287.422 13.056L287.312 12.88C287.327 12.7773 287.312 12.6747 287.268 12.572C287.239 12.4547 287.165 12.2933 287.048 12.088C286.725 11.7067 286.388 11.45 286.036 11.318C285.699 11.1713 285.339 11.098 284.958 11.098C284.401 11.098 283.873 11.2887 283.374 11.67C282.89 12.0513 282.494 12.616 282.186 13.364C281.893 14.0973 281.746 15.014 281.746 16.114C281.746 17.698 282.032 18.9447 282.604 19.854C283.191 20.7487 283.924 21.196 284.804 21.196C285.347 21.196 285.816 21.0787 286.212 20.844C286.608 20.6093 286.967 20.2207 287.29 19.678L289.006 20.954C288.493 21.79 287.884 22.384 287.18 22.736C286.491 23.0733 285.677 23.242 284.738 23.242ZM296.266 23V17.588L292.174 9.294H294.726L297.564 15.014L300.072 9.294H302.514L298.752 17.61V23H296.266ZM326.428 23L325.482 19.81H321.896L320.928 23H318.464L323.106 9.206H324.294L328.936 23H326.428ZM323.7 13.804L322.424 18.028H324.954L323.7 13.804ZM332.214 9.294H334.81L339.452 18.314L339.32 9.294H341.74V9.492C341.667 9.58 341.615 9.68267 341.586 9.8C341.571 9.90267 341.564 10.0713 341.564 10.306V23H339.254L334.458 13.386V23H332.214V9.294ZM352.828 23L351.882 19.81H348.296L347.328 23H344.864L349.506 9.206H350.694L355.336 23H352.828ZM350.1 13.804L348.824 18.028H351.354L350.1 13.804ZM359.054 9.294H361.76V9.492C361.672 9.58 361.613 9.68267 361.584 9.8C361.569 9.90267 361.562 10.0713 361.562 10.306V20.976H367.854V23H359.054V9.294ZM375.466 23V17.588L371.374 9.294H373.926L376.764 15.014L379.272 9.294H381.714L377.952 17.61V23H375.466ZM389.524 23.242C388.615 23.242 387.757 23.11 386.95 22.846C386.158 22.5673 385.498 22.1493 384.97 21.592L386.18 19.546L386.268 19.37L386.466 19.48C386.495 19.5973 386.532 19.7147 386.576 19.832C386.635 19.9347 386.752 20.0667 386.928 20.228C387.295 20.5067 387.698 20.734 388.138 20.91C388.593 21.086 389.084 21.174 389.612 21.174C390.301 21.174 390.859 21.0273 391.284 20.734C391.724 20.426 391.944 19.9787 391.944 19.392C391.944 19.0987 391.878 18.8273 391.746 18.578C391.614 18.314 391.35 18.05 390.954 17.786C390.573 17.522 390.001 17.214 389.238 16.862C388.299 16.4513 387.551 16.0407 386.994 15.63C386.451 15.2047 386.063 14.75 385.828 14.266C385.593 13.7673 385.476 13.21 385.476 12.594C385.476 11.9193 385.659 11.318 386.026 10.79C386.407 10.262 386.928 9.844 387.588 9.536C388.248 9.228 389.003 9.074 389.854 9.074C391.541 9.074 392.927 9.66067 394.012 10.834L392.56 12.506L392.428 12.66L392.252 12.528C392.237 12.4107 392.208 12.3007 392.164 12.198C392.135 12.0807 392.039 11.934 391.878 11.758C391.599 11.494 391.299 11.318 390.976 11.23C390.668 11.142 390.301 11.098 389.876 11.098C389.275 11.098 388.798 11.2373 388.446 11.516C388.094 11.7947 387.918 12.1173 387.918 12.484C387.918 12.7773 387.984 13.0413 388.116 13.276C388.248 13.5107 388.512 13.76 388.908 14.024C389.319 14.288 389.942 14.6033 390.778 14.97C391.702 15.3953 392.428 15.8133 392.956 16.224C393.484 16.62 393.851 17.06 394.056 17.544C394.276 18.028 394.386 18.5927 394.386 19.238C394.386 19.898 394.217 20.536 393.88 21.152C393.543 21.768 393.015 22.274 392.296 22.67C391.577 23.0513 390.653 23.242 389.524 23.242ZM398.94 23V20.998H401.624V11.296H399.094V9.294H406.662V11.296H403.978V20.998H406.772V23H398.94ZM415.924 23.242C415.015 23.242 414.157 23.11 413.35 22.846C412.558 22.5673 411.898 22.1493 411.37 21.592L412.58 19.546L412.668 19.37L412.866 19.48C412.895 19.5973 412.932 19.7147 412.976 19.832C413.035 19.9347 413.152 20.0667 413.328 20.228C413.695 20.5067 414.098 20.734 414.538 20.91C414.993 21.086 415.484 21.174 416.012 21.174C416.701 21.174 417.259 21.0273 417.684 20.734C418.124 20.426 418.344 19.9787 418.344 19.392C418.344 19.0987 418.278 18.8273 418.146 18.578C418.014 18.314 417.75 18.05 417.354 17.786C416.973 17.522 416.401 17.214 415.638 16.862C414.699 16.4513 413.951 16.0407 413.394 15.63C412.851 15.2047 412.463 14.75 412.228 14.266C411.993 13.7673 411.876 13.21 411.876 12.594C411.876 11.9193 412.059 11.318 412.426 10.79C412.807 10.262 413.328 9.844 413.988 9.536C414.648 9.228 415.403 9.074 416.254 9.074C417.941 9.074 419.327 9.66067 420.412 10.834L418.96 12.506L418.828 12.66L418.652 12.528C418.637 12.4107 418.608 12.3007 418.564 12.198C418.535 12.0807 418.439 11.934 418.278 11.758C417.999 11.494 417.699 11.318 417.376 11.23C417.068 11.142 416.701 11.098 416.276 11.098C415.675 11.098 415.198 11.2373 414.846 11.516C414.494 11.7947 414.318 12.1173 414.318 12.484C414.318 12.7773 414.384 13.0413 414.516 13.276C414.648 13.5107 414.912 13.76 415.308 14.024C415.719 14.288 416.342 14.6033 417.178 14.97C418.102 15.3953 418.828 15.8133 419.356 16.224C419.884 16.62 420.251 17.06 420.456 17.544C420.676 18.028 420.786 18.5927 420.786 19.238C420.786 19.898 420.617 20.536 420.28 21.152C419.943 21.768 419.415 22.274 418.696 22.67C417.977 23.0513 417.053 23.242 415.924 23.242Z"
        fill="#89D2FF"
      />
      <path d="M24.5 32.5H638.5V340.5H24V32.5V32" stroke="#0C4367" />
      <rect x="24" y="32" width="615" height="309" fill="#0C4569" />
      <defs>
        <linearGradient
          id="paint0_linear_437_1950"
          x1="801.681"
          y1="-308.243"
          x2="-78.3047"
          y2="418.714"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0.169223" stop-color="#00092A" stop-opacity="0.77" />
          <stop offset="0.861292" stop-color="#004970" />
          <stop offset="1" stop-color="#004970" stop-opacity="0" />
        </linearGradient>
      </defs>
      <foreignObject x="30" y="20" width="600" height="360">
        <Plot
          data={[
            {
              x: stftData.F.map((row) => row[0]),
              y: stftData.T[0],
              z: transposeMatrix(stftData.Zxx_compressed_resized),
              type: "heatmap",
              colorbar: {
                title: {
                  text: "dBrms ref 1 μPa/√Hz",
                  side: "right",
                },
              },
            },
          ]}
          layout={{
            width: 610,
            height: 308,
            margin: {
              t: 50,
              b: 50,
              l: 50,
              r: 50,
            },
            font: {
              color: "#0CFEFF",
            },
            plot_bgcolor: "transparent",
            paper_bgcolor: "transparent",
            xaxis: {
              title: {
                text: "Frequency (Hz)",
                standoff: 25,
              },
            },
            yaxis: {
              title: {
                text: "Time (sec)",
                standoff: 20,
              },
            },
          }}
          config={{
            displayModeBar: false,
          }}
        />
      </foreignObject>
    </svg>
  );
}

export default LofarPlot;
